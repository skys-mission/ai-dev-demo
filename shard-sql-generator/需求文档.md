# 分片SQL生成器 - 需求文档

## 1. 项目背景与目标

### 1.1 背景
在没有引入DB-Proxy的数据库分片环境中（特别是MySQL分片场景），开发人员和DBA需要手动生成针对不同分片节点的SQL语句来排查问题，这一过程效率低下且容易出错。

### 1.2 目标
开发一个轻量级的Web工具，帮助用户快速生成针对不同分片节点的SQL语句，支持灵活的分片规则配置和脚本管理，提高数据库分片环境下的问题排查效率。

## 2. 核心功能需求

### 2.1 SQL生成功能
- **基础SQL输入**：支持用户输入原始SQL语句（SELECT/UPDATE/DELETE/INSERT）
- **分片规则选择**：提供多种内置分片算法，支持用户选择并配置参数
- **分片键值输入**：支持用户输入分片键值，用于计算目标分片
- **批量生成**：支持输入多个分片键值，批量生成对应分片的SQL
- **SQL预览**：实时预览生成的分片SQL，支持复制单个或全部SQL

### 2.2 脚本管理功能
- **内置分片算法**：
  - 取模算法（Mod）：支持自定义模数
  - 范围分片：支持配置分片范围规则
  - 哈希分片：支持MD5/SHA1等哈希算法
  - 一致性哈希：支持虚拟节点配置
  - 日期分片：按年/月/日/小时等时间维度分片
- **自定义脚本**：
  - 支持用户编写JavaScript分片脚本
  - 脚本参数配置界面
  - 脚本保存、编辑、删除功能

### 2.3 用户体验功能
- **历史记录**：保存用户最近使用的SQL和分片配置
- **SQL格式化**：支持输入和输出SQL的格式化
- **语法高亮**：SQL语法高亮显示
- **深色/浅色主题切换**：支持用户偏好设置

## 3. 技术需求

### 3.1 开发技术栈
- **后端**：纯Node.js原生实现（无第三方依赖）
- **前端**：HTML5 + CSS3 + JavaScript（原生实现，无框架依赖）
- **数据存储**：本地JSON文件存储（配置、脚本、历史记录）

### 3.2 架构设计
- **模块化设计**：功能模块化，便于扩展和维护
- **无状态设计**：不依赖外部服务，便于部署和迁移
- **响应式设计**：支持桌面和移动端访问

### 3.3 性能要求
- 页面加载时间 < 2s
- SQL生成响应时间 < 1s
- 支持同时处理100+分片键值的批量生成

## 4. 界面设计要求

### 4.1 设计风格
- **简洁现代**：清晰的信息层次，无冗余元素
- **高级感**：合理的留白，精致的动画效果
- **易用性**：直观的操作流程，最少的点击次数
- **色彩方案**：以蓝色为主色调（代表技术和可靠性），搭配中性色，色彩过渡自然

### 4.2 界面布局
- **顶部导航**：项目名称、功能菜单、主题切换
- **左侧面板**：分片规则选择和配置
- **中间区域**：SQL输入和预览
- **右侧面板**：脚本管理和历史记录
- **底部区域**：操作按钮（生成、复制、清空等）

## 5. 部署需求

### 5.1 裸机部署
- **环境要求**：Node.js 14+ 环境
- **部署步骤**：简单的文件复制和启动命令
- **配置方式**：环境变量或配置文件

### 5.2 Docker部署
- **Docker镜像**：提供官方Docker镜像
- **容器化配置**：包含完整的Dockerfile和docker-compose.yml
- **一键部署**：支持通过docker-compose快速启动

## 6. 需求合理性与可维护性分析

### 6.1 需求合理性
- **解决实际痛点**：直接解决了分片环境下手动生成SQL的效率问题
- **技术可行性**：使用纯Node.js原生实现，技术成熟且稳定
- **资源投入合理**：轻量级应用，开发和维护成本可控
- **用户群体明确**：数据库开发人员、DBA、运维人员

### 6.2 可维护性分析
- **模块化设计**：功能模块化，便于扩展和维护
- **清晰的代码结构**：遵循Node.js最佳实践，代码可读性高
- **文档完善**：包含详细的需求文档、开发文档和使用文档
- **无外部依赖**：减少了依赖管理的复杂性和安全风险

## 7. 项目实现结果

### 7.1 已实现功能
- ✅ SQL生成：支持6种分片算法
- ✅ 脚本管理：内置算法 + 自定义脚本
- ✅ 用户界面：现代化设计，简洁易用
- ✅ API接口：完整的RESTful API
- ✅ 部署方案：裸机部署 + Docker部署
- ✅ 性能优化：核心功能优化

### 7.2 项目文件结构
```
shard-sql-generator/
├── core/              # 核心功能模块
│   ├── sql-generator.js     # SQL生成器
│   └── script-manager.js    # 脚本管理器
├── public/            # 前端静态文件
│   ├── index.html     # 主页面
│   ├── styles.css     # 样式文件
│   └── app.js         # 前端逻辑
├── data/              # 数据存储
│   └── scripts/       # 脚本存储目录
├── server.js          # 服务器入口
├── Dockerfile         # Docker配置
├── docker-compose.yml # Docker Compose配置
├── package.json       # 项目配置
└── README.md          # 项目说明
```

---

**文档版本**：v1.0
**编写日期**：2024-05-31
**编写人**：AI Assistant